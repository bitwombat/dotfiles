" VIM settings that should always be
"

" Features {{{
filetype on
filetype plugin on
syntax on
" When finding or ctrl-x, search entire tree
set path+=**

set listchars=tab:>.,trail:.,extends:#,nbsp:.,eol:$
set pastetoggle=<F2>
set backspace=indent,eol,start
" }}}

" Visual settings {{{
set laststatus=2
set modeline
set ruler
set showcmd
set showmatch
set showmode

" Use a cursor line when navigating around, off when in insert mode
set cursorline
autocmd InsertLeave,WinEnter * set cursorline
autocmd InsertEnter,WinLeave * set nocursorline

set fillchars+=vert:â”‚  " Vertical split 

" Fix error highlighting in terminal
highlight clear SpellBad
highlight SpellBad term=standout ctermfg=1 term=underline cterm=underline

" Set the title of the screen window
if &term =~ "screen"
  set t_ts=k
  set t_fs=\
endif
if &term =~ "screen" || &term == "xterm"
  set title
endif
set titlestring=%{expand(\"%:t\")}

" Make background clearing work in GNU screen
set t_ut=
" }}}

" Folding settings {{{
set foldmethod=indent
set foldlevelstart=1
syn region myFold start="{" end="}" transparent fold
syn sync fromstart

" Without the following, folding doesn't work on php .inc files
set nocompatible
let g:php_folding=1
let g:javaScript_fold=1

" The markdown ftplugin is enabled with this
let g:markdown_folding=1

" }}}

" Feature-related variables {{{
set autowrite
set backup
set backupdir=/tmp
"set complete+=k
"set dictionary=/usr/share/dict/words
set noerrorbells
set fileformat=unix
set scrolloff=2
set vb t_vb=
set wildmenu
"set wildmode=list:longest,full
" }}}

" Search settings {{{
set ignorecase
set incsearch
set smartcase
set hlsearch
" }}}

" Editor behaviour {{{
set tabstop=4
set softtabstop=4
set shiftwidth=4
set wrap
set textwidth=79
set formatoptions=q
set expandtab
"set colorcolumn=85
" }}}

" Keys {{{
let mapleader = " "
nnoremap <leader>n :NERDTree<CR>
nnoremap <leader>p :CtrlPBuffer<CR>
nnoremap <leader>b :BufExplorer<CR><CR>
nnoremap <leader>s :BufExplorerVerticalSplit<CR>
nnoremap <leader>c :cd %:h<CR>

" Allows you to easily replace the current word and all its occurrences. (Global Change)
nnoremap <leader>gc :%s/\<<C-r><C-w>\>/
vnoremap <leader>gc y:%s/<C-r>"/

" Make it easier to edit vimrc
nnoremap <leader>ev :vsplit $MYVIMRC<cr>
nnoremap <leader>sv :source $MYVIMRC<cr>

" Move to match with tab
nmap <tab> %
vmap <tab> %

" Escape from insert mode with jj
inoremap jj <ESC>

" Ctrl-C in insert mode opens up a line - for inside things like {}
imap <C-c> <CR><Esc>O<Tab>

" Yank from the cursor to the end of the line, to be consistent with C and D.
nnoremap Y y$

" Fixing
map F gq}
map T :%s/  *$//g<CR>

" Macroing
map L @l

" IDE
map Q :w<CR>:!clear;python %<CR>
" map Q :w<CR>:!clear;ruby test/bottles_test.rb<CR>
map <F11> :cn<CR>
map <F10> :cN<CR>

" Saving
map <F1> :update<CR>
inoremap <F1> <ESC>:update<CR>a
map <C-s> :update<CR>
imap <C-s> <ESC>:update<CR>a

" Quitting
" closes the current window.  Will exit if last window (unlike Ctrl-W C).
nnoremap <C-d> :q<CR>

" Viewing Modes
map <F6> :set invnumber<CR>
map <F7> :if exists("syntax_on") <Bar> syntax off <Bar> <CR> else <Bar> syntax on <Bar> endif <CR>
map <F8> :if &ignorecase <Bar> set noic <Bar> <CR> else <Bar> set ic <Bar> endif <CR>
map <F9> :if &list <Bar> set nolist <Bar> <CR> else <Bar> set list <Bar> endif <CR>

" Buffers
map n :bnext<CR>
map m :bprevious<CR>
" Leftover from old muscle memory (P for previous).  Delete when untrained.
map p :bprevious<CR>

" Tabs
map k :tabnext<CR>
map j :tabprevious<CR>
map c :tabclose<CR>
map t :tabnew<CR>

" Folding
map U zA
map , za

" Copy the entire buffer to the system clipboard (like Ctrl-A)
noremap <leader>a <Esc>gg"+yG

" Ctrl-A and Ctrl-E work as they do on the command line
map <C-a> ^
map <C-e> $
inoremap <C-a> <C-o>^
inoremap <C-e> <C-o>$

" Quickly select the text that was just pasted. This allows you to, e.g.,
" indent it after pasting.
noremap gV `[v`]

" Stay in visual mode when indenting. You will never have to run gv after
" performing an indentation.
vnoremap < <gv
vnoremap > >gv

" Remove the highlighting from the search
nmap <silent> <BS>  :nohlsearch<CR>

" Splitting
noremap <C-w>- :split<cr>
noremap <C-w>\| :vsplit<cr>

" Change cw and dw to know about camelCase and underscores
" Problem with this is the hlsearch options highlights a bunch of stuff in the
" file since we're using /.  Didn't find a "non-saved" / in vim.  
" Installed https://github.com/chaoren/vim-wordmotion  which seems to work
" but not with PhpStorm's Vim plugin.
"map cw c/\u\\|[^0-9A-Za-z_]<CR>
"map dw d/\u\\|[^0-9A-Za-z_]<CR>
" }}}

" Ctags {{{
    set tags=./tags,tags
    let &tags = &tags . ',/www/aquasafe/app/.project_ctags'
" }}}

" vim:foldmethod=marker:foldlevel=0
