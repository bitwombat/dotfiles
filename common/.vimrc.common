" VIM settings that should always be
"

" Features {{{
filetype on
filetype plugin indent on
syntax on
" When finding or ctrl-x, search entire tree
set path+=**

set listchars=tab:>.,trail:.,extends:#,nbsp:.,eol:$
set pastetoggle=<F2>
set backspace=indent,eol,start
" }}}

" Visual settings {{{
set laststatus=2
set modeline
set ruler
set showcmd
set showmatch
set showmode

" Use a cursor line when navigating around, off when in insert mode
set cursorline
autocmd InsertLeave,WinEnter * set cursorline
autocmd InsertEnter,WinLeave * set nocursorline

set fillchars+=vert:â”‚  " Vertical split

" Fix error highlighting in terminal
highlight clear SpellBad
highlight SpellBad term=standout ctermfg=1 term=underline cterm=underline

" Set the title of the screen window
if &term =~ "screen"
  set t_ts=k
  set t_fs=\
endif
if &term =~ "screen" || &term == "xterm"
  set title
endif
set titlestring=%{expand(\"%:t\")}

" Make background clearing work in GNU screen
set t_ut=
" }}}

" Folding settings {{{
set foldmethod=indent
set foldlevelstart=1
syn region myFold start="{" end="}" transparent fold
syn sync fromstart

" Without the following, folding doesn't work on php .inc files
set nocompatible
let g:php_folding=1
let g:javaScript_fold=1

" The markdown ftplugin is enabled with this
let g:markdown_folding=1

" }}}

" Feature-related variables {{{
set autowrite
set backup
set backupdir=/tmp
"set complete+=k
"set dictionary=/usr/share/dict/words
set noerrorbells
set fileformat=unix
set scrolloff=2
set vb t_vb=
set wildmenu
" }}}

" Search settings {{{
set ignorecase
set incsearch
set smartcase
set hlsearch
" }}}

" Editor behaviour {{{
set tabstop=4
set softtabstop=4
set shiftwidth=4
set wrap
set textwidth=79
set formatoptions=jqrocb
set expandtab
"set colorcolumn=85
" }}}

" Keys {{{
let mapleader = " "
nnoremap <leader>nt :NERDTree<CR>
nnoremap <leader>cp :CtrlPBuffer<CR>
nnoremap <leader>cd :cd %:h<CR>
vnoremap <leader>c "+y
nnoremap <leader>p "+p
nnoremap <leader>P "+P
vnoremap <leader>p "+p
vnoremap <leader>P "+P

" Allows you to easily replace the current word and all its occurrences. (Global Change)
nnoremap <leader>gc :%s/\<<C-r><C-w>\>/
vnoremap <leader>gc y:%s/<C-r>"/

" Move to match with tab
nnoremap <tab> %
vnoremap <tab> %

" Escape from insert mode with jj
inoremap jj <ESC>

" Move screen line instead of buffer line
nnoremap <C-J> gj
nnoremap <C-K> gk

" Ctrl-C in insert mode opens up a line - for inside things like {}
inoremap <C-c> <CR><Esc>O<Tab>

" Replace the next space with a newline
nnoremap <leader>J f xi<CR><Esc>

" Yank from the cursor to the end of the line, to be consistent with C and D.
nnoremap Y y$

" Fixing
nnoremap F gq}
nnoremap T :%s/  *$//g<CR>

" Macroing
nnoremap L @l

" IDE
nnoremap Q :w<CR>:!clear;python3 %<CR>
" map Q :w<CR>:!clear;ruby test/bottles_test.rb<CR>
nnoremap <F11> :cn<CR>
nnoremap <F10> :cN<CR>

" Saving
noremap <F1> :update<CR>
inoremap <F1> <ESC>:update<CR>a
noremap <C-s> :update<CR>
inoremap <C-s> <ESC>:update<CR>a

" Quitting
" closes the current window.  Will exit if last window (unlike Ctrl-W C).
nnoremap <C-d> :q<CR>

" Viewing Modes
noremap <F5> :set relativenumber!<CR>
noremap <F6> :set number!<Bar>:set relativenumber!<CR>
noremap <F7> :if exists("syntax_on") <Bar> syntax off <Bar> <CR> else <Bar> syntax on <Bar> endif <CR>
noremap <F8> :if &ignorecase <Bar> set noic <Bar> <CR> else <Bar> set ic <Bar> endif <CR>
noremap <F9> :set list!<Bar>set list?<CR>

" Relative numbers
set number relativenumber

augroup numbertoggle
  autocmd!
  autocmd BufEnter,FocusGained,InsertLeave * set relativenumber
  autocmd BufLeave,FocusLost,InsertEnter   * set norelativenumber
augroup END

" Buffers
nnoremap <leader>k :bnext<CR>
nnoremap <leader>j :bprevious<CR>

" Tabs
nnoremap <leader>tk :tabnext<CR>
nnoremap <leader>tj :tabprevious<CR>
nnoremap <leader>tc :tabclose<CR>
nnoremap <leader>tn :tabnew<CR>

" Folding
noremap U zA
noremap , za

" Copy the entire buffer to the system clipboard (like Ctrl-A)
noremap <leader>a <Esc>gg"+yG

" Ctrl-A and Ctrl-E work as they do on the command line
noremap <C-a> ^
noremap <C-e> $
inoremap <C-a> <C-o>^
inoremap <C-e> <C-o>$

" Quickly select the text that was just pasted. This allows you to, e.g.,
" indent it after pasting.
noremap gV `[v`]

" Stay in visual mode when indenting. You will never have to run gv after
" performing an indentation.
vnoremap < <gv
vnoremap > >gv

" Remove the highlighting from the search
nnoremap <silent> <BS>  :nohlsearch<CR>

" Splitting
noremap <C-w>- :split<cr>
noremap <C-w>\| :vsplit<cr>

" Change cw and dw to know about camelCase and underscores
" Problem with this is the hlsearch options highlights a bunch of stuff in the
" file since we're using /.  Didn't find a "non-saved" / in vim.
" Installed https://github.com/chaoren/vim-wordmotion  which seems to work
" but not with PhpStorm's Vim plugin.
"map cw c/\u\\|[^0-9A-Za-z_]<CR>
"map dw d/\u\\|[^0-9A-Za-z_]<CR>
" }}}

" Ctags {{{
    set tags=./tags,tags
    let &tags = &tags . ',/www/aquasafe/app/.project_ctags'
" }}}

" vim:foldmethod=marker:foldlevel=0
